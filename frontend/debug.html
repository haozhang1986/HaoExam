<!DOCTYPE html>
<html>

<head>
    <title>HaoExam Debug Page</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }

        .test {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333;
        }

        .pass {
            color: #00ff00;
        }

        .fail {
            color: #ff0000;
        }
    </style>
</head>

<body>
    <h1>üîç HaoExam Debug Diagnostics</h1>

    <div class="test" id="test-scripts">
        <h3>1. Script Loading Test</h3>
        <p id="result-multi">MultiSelectDropdown: <span id="multi-status">Ê£ÄÊµã‰∏≠...</span></p>
        <p id="result-api">API_BASE_URL: <span id="api-status">Ê£ÄÊµã‰∏≠...</span></p>
    </div>

    <div class="test" id="test-api">
        <h3>2. API Connection Test</h3>
        <p id="result-curriculum">Curriculum API: <span id="curr-status">Ê£ÄÊµã‰∏≠...</span></p>
        <p id="result-questions">Questions API: <span id="q-status">Ê£ÄÊµã‰∏≠...</span></p>
    </div>

    <div class="test" id="test-dom">
        <h3>3. DOM Elements Test</h3>
        <p>Login Button: <span id="dom-login">Ê£ÄÊµã‰∏≠...</span></p>
        <p>Topic Filter: <span id="dom-topic">Ê£ÄÊµã‰∏≠...</span></p>
    </div>

    <div class="test">
        <h3>4. Actions</h3>
        <button onclick="location.reload(true)"
            style="padding: 10px; background: #333; color: #00ff00; border: none; cursor: pointer;">
            üîÑ Hard Refresh This Page
        </button>
        <button onclick="window.location='/?v=' + Date.now()"
            style="padding: 10px; background: #333; color: #00ff00; border: none; cursor: pointer; margin-left: 10px;">
            üè† Go to Main Page (Force Fresh)
        </button>
    </div>

    <script src="multi-select.js?v=2.0"></script>
    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';

        // Test 1: Script Loading
        setTimeout(() => {
            const multiStatus = document.getElementById('multi-status');
            const apiStatus = document.getElementById('api-status');

            if (typeof MultiSelectDropdown !== 'undefined') {
                multiStatus.innerHTML = '<span class="pass">‚úÖ LOADED</span>';
            } else {
                multiStatus.innerHTML = '<span class="fail">‚ùå NOT FOUND</span>';
            }

            if (typeof API_BASE_URL !== 'undefined') {
                apiStatus.innerHTML = `<span class="pass">‚úÖ ${API_BASE_URL}</span>`;
            } else {
                apiStatus.innerHTML = '<span class="fail">‚ùå UNDEFINED</span>';
            }
        }, 500);

        // Test 2: API Connection
        fetch(`${API_BASE_URL}/metadata/distinct/curriculum`)
            .then(r => r.json())
            .then(data => {
                document.getElementById('curr-status').innerHTML = `<span class="pass">‚úÖ ${JSON.stringify(data)}</span>`;
            })
            .catch(e => {
                document.getElementById('curr-status').innerHTML = `<span class="fail">‚ùå ${e.message}</span>`;
            });

        fetch(`${API_BASE_URL}/questions/?limit=1`)
            .then(r => r.json())
            .then(data => {
                document.getElementById('q-status').innerHTML = `<span class="pass">‚úÖ ${data.length} question(s)</span>`;
            })
            .catch(e => {
                document.getElementById('q-status').innerHTML = `<span class="fail">‚ùå ${e.message}</span>`;
            });

        // Test 3: DOM (simulate main page)
        setTimeout(() => {
            document.getElementById('dom-login').innerHTML = '<span class="pass">‚ÑπÔ∏è Check on main page</span>';
            document.getElementById('dom-topic').innerHTML = '<span class="pass">‚ÑπÔ∏è  Check on main page</span>';
        }, 100);
    </script>
</body>

</html>